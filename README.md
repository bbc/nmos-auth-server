<!---NAME--->
# RD-APMM-PYTHON-OAUTH-SECURITY
<!---/NAME--->

This is an example of a python package which can be built and modified
as needed.

<!---TEMPLATE_ONLY--->
In addition the script `create_new_repo.py` can be run and will create
a new copy of this template set up with the module name specified.

The new repo created by this command doesn't have the
`create_new_repo.py` script, and should only have one commit.
<!---/TEMPLATE_ONLY--->

## Basic Use of this Project

A Makefile has been provided which provides easy access to several
important methods we want to do pretty often:

> make source  - Create source package
> make install - Install on local system (only during development)
> make clean   - Get rid of scratch and byte files
> make test    - Test using tox and nose2
> make deb     - Create deb package
> make rpm     - Create rpm package
> make wheel   - Create whl package
> make egg     - Create egg package

I'd recommend against using the `make install` command in general:
much better to run:

```bash
    pip install -e .
```

in the top directory to install the package in an editable form so
that changes make to the local version are reflected in the python
environment. You'll likely want to do that in a virtual environment
most often.

## Testing

The `make test` command invokes `tox`. You can invoke it directly like
this:

```bash
    tox
```

either way it makes use of the configuration in `tox.ini` to set up
virtual environments to run tests in and then run all tests. The
provided configuration runs the `nose2` test runner under `python2.7`
and `python3`, but other configurations are possible.

The default test command is:

```bash
    nose2 --with-coverage --coverage-report=annotate \
        --coverage-report=term --coverage=TEMPLATE
```

which will discover all tests in the `tests` directory and run them
recording coverage of files in the main package directory. The
coverage report is printed to the terminal during running but is also
used to create annotated `.py,cover` files which are copies of the
`.py` source files with each line marked with a character to indicate
whether it is covered (`>`), not covered (`!`), or specifically
ignored for coverage purposes (`-`).

## Uploading to artifactory

Once you have a project that passes tests you can build a source
distribution for it with

```bash
    make source
```

and a wheel distribution with

```bash
    make wheel
```

this will result in these artifacts being placed in the `dist`
directory. You can then upload these to artifactory using a command
like:

```bash
    twine upload --repository-url \
        https://artifactory-noforge.virt.ch.bbc.co.uk/artifactory/api/pypi/ap-python \
        -u $USERNAME -p $PASSWORD dist/*
```

assuming you have twine installed and `USERNAME` and `PASSWORD`
are your artifactory username and API key.

## Adding overrides to the debian packaging

Any files placed in the directory `debian` will be copied into the actual debian
directory when making a new deb package, possibly overwriting anything already there.

## Using a custom rpm spec file

If desired a custom written spec file can be used for making rpms
instead of the one autogenerated from setup.py. To do this place this
file in the rpm directory and remove the indicated rules in the
Makefile for creating the spec file.
