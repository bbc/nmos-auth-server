{% extends "layout.html" %}
{% block body %}
<!-- <script type=text/javascript>
  $(function() {
    $('a#calculate').bind('click', function() {
      $.getJSON($SCRIPT_ROOT + '/_add_numbers', {
        a: $('input[name="a"]').val(),
        b: $('input[name="b"]').val()
      }, function(data) {
        $("#result").text(data.result);
      });
      return false;
    });
  });
</script>

<h1>jQuery Example</h1>
<p><input type=text size=5 name=a> +
   <input type=text size=5 name=b> =
   <span id=result>?</span>
<p><a href=# id=calculate>calculate server side</a>
 -->

<script>
  $(function getToken() {
    console.log("Inside Function");
    $("#token").click(function(){
      var grant_type = "password";
      //var username = document.getElementById("username").value
      //var password = document.getElementById("password").value
      //var scope = document.getElementById("scope").value
      var requestPayload = {
                  'grant_type': 'password',
                  'username': document.getElementById("username").value,
                  'password': document.getElementById("password").value,
                  'scope': document.getElementById("scope").value
      };
      $.ajax({
        url: 'http://127.0.0.1:5000/oauth/token',
        type: 'POST',
        data: requestPayload,
        dataType: 'json',
        username: 'mpLdzPAchfON4qVCz6GO3o6S',
        password: 'zIEYbZYMvu1XNT1bBurWS1tg0n58j91v5pchfBXOf9iAdzO3',
        //contentType: 'x-www-form-urlencoded',
        error: function (XMLHttpRequest, textStatus, errorThrown) {
            alert('Error: ' + errorThrown);
            console.log(XMLHttpRequest.status + ' ' + XMLHttpRequest.statusText);
            return false;
        },
        success: function(data) {
          accessToken = data.access_token;
          alert('Success!\r\nAccess Token:\r' + accessToken + '\r\n');
          console.log('Success!');
          localStorage.setItem('token', accessToken);
          return result;
        }
      });
    });
  });
</script>


<script>
  $(function getResource() {
    $("#resource").click(function(){
      console.log("Inside Function");
      console.log(localStorage.getItem('token'));
      $.ajax({
        url: 'http://127.0.0.1:5000/api/me',
        type: 'GET',
        contentType: 'x-www-form-urlencoded',
        dataType: 'json',
        // Fetch the stored token from localStorage and set in the header
        beforeSend: function (xhr) { xhr.setRequestHeader ("Authorization", "Bearer " + localStorage.getItem('token')); },
        success: function (result) {
          var returnResult = JSON.stringify(result);
          alert('Success!\r\n' + returnResult);
          document.getElementById('callResults').innerHTML = returnResult;
          return result;
        },
        error: function (XMLHttpRequest, textStatus, errorThrown) {
            alert('Error: ' + errorThrown);
            console.log(XMLHttpRequest.status + ' ' + XMLHttpRequest.statusText);
            return false;
        }
      });
    });
  });
</script>


<!-- List of Agents within a BU -->
<br><br>
<form action="/request_token" method="post">
  <label>
    <input type="text" name="client_id" id="client_id" placeholder="client_id" value="{{client.client_id}}" readonly="readonly"><br>
  </label>
  <label>
    <input type="text" name="client_secret" id="client_secret" placeholder="client_secret" value="{{client.client_secret}}" readonly="readonly"><br>
  </label>
  <label>
    <input type="text" name="username" id="username" placeholder="username"><br>
  </label>
  <label>
    <input type="text" name="password" id="password" placeholder="password"><br>
  </label>
  <label>
    <input type="text" name="scope" id="scope" placeholder="scope"><br>
  </label>
</form>

<button id="token">Get Token</button>
<br />
<div id="pageDiv"></div>
<br />
<button id="resource">Run</button><br>
<br />Results:
<br />
<div id="callResults"></div>



{% endblock %}
